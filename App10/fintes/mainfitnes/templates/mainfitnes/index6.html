{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–û–ø–ª–∞—Ç–∞ –∞–±–æ–Ω–µ–º–µ–Ω—Ç–∞ - BodyClub</title>
    <link rel="stylesheet" href="{% static 'mainfitnes/css/style.css' %}">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="header_logo">
                <a href="{% url 'index' %}" class="header_logo_h1"> BodyClub </a>
            </div>
                <nav class="navigation">
                    <a href="{% url 'index2' %}" class="navigation_a"> –ê–±–æ–Ω–µ–º–µ–Ω—Ç—ã</a>
                    <a href="{% url 'index3' %}" class="navigation_a"> –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ </a>
                    <a href="{% url 'index4' %}" class="navigation_a"> –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ </a>
                    <a href="{% url 'index5' %}" class="navigation_a"> –ö–æ–Ω—Ç–∞–∫—Ç—ã </a>
                    {% if user.is_authenticated %}
                        <a href="{% url 'profile' %}" class="navigation_a">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</a>
                    {% else %}
                        <a href="{% url 'login' %}" class="navigation_a">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</a>
                    {% endif %}
                </nav>
            <div class="svaz">
                <button class="callback-btn">–û–±—Ä–∞—Ç–Ω—ã–π –∑–≤–æ–Ω–æ–∫</button>
            </div>
            <button class="hamburger" id="hamburger">&#9776;</button>
        </header>

        <div class="crumbl_block">
            <p class="crumbs_text">–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ / –ê–±–æ–Ω–µ–º–µ–Ω—Ç—ã / –û–ø–ª–∞—Ç–∞</p>
        </div>

        <div class="payment-container">
            <h2 class="payment-title">–û–ø–ª–∞—Ç–∞ –∞–±–æ–Ω–µ–º–µ–Ω—Ç–∞</h2>
            
            <div class="subscription-info">
                <h3>–í—ã–±—Ä–∞–Ω–Ω—ã–π –∞–±–æ–Ω–µ–º–µ–Ω—Ç</h3>
                <p id="selected-subscription">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</p>
            </div>
            
            <div id="payment-form-container">
                <form id="payment-form" class="payment-form" method="POST">
                    {% csrf_token %}
                    <input type="hidden" id="subscription-id" name="subscription_id">
                    <input type="hidden" id="subscription-title" name="subscription_title">
                    <input type="hidden" id="subscription-price" name="subscription_price">
                    
                    <h3>–ü–ª–∞—Ç–µ–∂–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h3>

                    <div class="form-group">
                        <label for="card-name">–í–∞—à–µ –§–ò–û</label>
                        <input type="text" id="card-name" name="card_name" placeholder="IVAN IVANOV" required>
                    </div>

                    <div class="form-group">
                        <label for="card-number">–ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã</label>
                        <input type="text" id="card-number" name="card_number" placeholder="1234 5678 9012 3456" required>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="card-expiry">–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è</label>
                            <input type="text" id="card-expiry" name="card_expiry" placeholder="MM/YY" required>
                        </div>
                        <div class="form-group">
                            <label for="card-cvv">CVV/CVC</label>
                            <input type="text" id="card-cvv" name="card_cvv" placeholder="123" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="card-name">–ò–º—è –≤–ª–∞–¥–µ–ª—å—Ü–∞ –∫–∞—Ä—Ç—ã</label>
                        <input type="text" id="card-name" name="card_name" placeholder="IVAN IVANOV" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="email">Email –¥–ª—è —á–µ–∫–∞</label>
                        <input type="email" id="email" name="email" placeholder="email@example.com" required>
                    </div>
                    
                    <button type="submit" class="submit-btn">–û–ø–ª–∞—Ç–∏—Ç—å</button>
                </form>
            </div>
            
            <div id="success-container" class="success-container">
                <div class="success-icon">
                    <div class="circle"></div>
                    <div class="checkmark"></div>
                </div>
                <div class="success-message">–û–ø–ª–∞—Ç–∞ –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ!</div>
                <p>–í–∞—à –∞–±–æ–Ω–µ–º–µ–Ω—Ç –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω. –ß–µ–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω—ã–π email.</p>
                <button class="back-btn" onclick="window.location.href='{% url 'index2' %}'">–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –∞–±–æ–Ω–µ–º–µ–Ω—Ç–∞–º</button>
            </div>
        </div>
        
        <footer class="footer">
            <div class="footer-main">
                <div class = "foter-main_ogr">
                    <div class="footer-left">
                        <h2 class="footer-logo">BodyClub</h2>
                        <ul class="footer-links">
                            <li> <a href="{% url 'index2' %}"> –ê–±–æ–Ω–µ–º–µ–Ω—Ç—ã </a> </li>
                            <li> <a href="{% url 'index3' %}"> –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ </a> </li>
                            <li> <a href="{% url 'index4' %}"> –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ </a> </li>
                            <li> <a href="{% url 'index5' %}"> –ö–æ–Ω—Ç–∞–∫—Ç—ã </a> </li>
                        </ul>
                        <button class="callback-btn">–û–±—Ä–∞—Ç–Ω—ã–π –∑–≤–æ–Ω–æ–∫</button>
                    </div>
                    <div class="footer-right">
                        <a href="tel:+79999999999">‚òé +7 (999) 999-99-99</a>
                        <a href="https://bodyclub.ru" target="_blank">üåê bodyclub.ru</a>

                        <iframe
                            src="https://yandex.ru/map-widget/v1/?um=constructor%3Aexamplemapid&amp;source=constructor"
                            class="footer-map"
                            frameborder="0"
                            allowfullscreen
                        ></iframe>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <div class="footer-bottom-logo">BodyClub</div>
                <ul class="footer-bottom-links">
                    <li> <a href="{% url 'index2' %}" class="navigation_a"> –ê–±–æ–Ω–µ–º–µ–Ω—Ç—ã </a> </li>
                    <li> <a href="{% url 'index3' %}" class="navigation_a"> –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ </a> </li>
                    <li> <a href="{% url 'index4' %}" class="navigation_a"> –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ  </a> </li>
                    <li> <a href="{% url 'index5' %}" class="navigation_a"> –ö–æ–Ω—Ç–∞–∫—Ç—ã </a> </li>
                </ul>
            </div>
        </footer>
    </div>


    <div id="callback-modal" class="modal">
        <div class="modal-content">
            <span class="modal-close">&times;</span>
            <h3>–ó–∞–∫–∞–∑–∞—Ç—å –æ–±—Ä–∞—Ç–Ω—ã–π –∑–≤–æ–Ω–æ–∫</h3>
            <form id="callback-form" method="POST">
                {% csrf_token %}
                <div class="form-group">
                    <label for="callback-name">–í–∞—à–µ –∏–º—è:</label>
                    <input type="text" id="callback-name" name="name" required>
                </div>
                <div class="form-group">
                    <label for="callback-phone">–¢–µ–ª–µ—Ñ–æ–Ω:</label>
                    <input type="tel" id="callback-phone" name="phone" required>
                </div>
                <button type="submit" class="submit-btn">–ü–µ—Ä–µ–∑–≤–æ–Ω–∏—Ç–µ –º–Ω–µ</button>
            </form>
            <div id="callback-success" style="display: none;">
                <p>–°–ø–∞—Å–∏–±–æ! –ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏ –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è.</p>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const subscriptionId = urlParams.get('id');
            const subscriptionTitle = urlParams.get('title');
            const subscriptionPrice = urlParams.get('price');
            
            if (subscriptionTitle && subscriptionPrice) {
                document.getElementById('selected-subscription').textContent = 
                    `${subscriptionTitle} - ${subscriptionPrice} ‚ÇΩ`;
                document.getElementById('subscription-id').value = subscriptionId;
                document.getElementById('subscription-title').value = subscriptionTitle;
                document.getElementById('subscription-price').value = subscriptionPrice;
            } else {
                document.getElementById('selected-subscription').textContent = 
                    '–ê–±–æ–Ω–µ–º–µ–Ω—Ç –Ω–µ –≤—ã–±—Ä–∞–Ω';
            }
            

            document.getElementById('payment-form').addEventListener('submit', function(e) {
                e.preventDefault();
                

                

                document.getElementById('payment-form-container').style.display = 'none';
                document.getElementById('success-container').style.display = 'block';
                

                const formData = new FormData(this);
                
                fetch('/process-payment/', {
                    method: 'POST',
                    body: formData,
                    headers: {
                        'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (!data.success) {
                        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –ø–ª–∞—Ç–µ–∂–∞:', data.error);
                    }
                })
                .catch(error => {
                    console.error('–û—à–∏–±–∫–∞:', error);
                });
            });
            

            document.getElementById('card-number').addEventListener('input', function(e) {
                let value = this.value.replace(/\s+/g, '').replace(/[^0-9]/gi, '');
                let formatted = '';
                
                for (let i = 0; i < value.length && i < 16; i++) {
                    if (i > 0 && i % 4 === 0) {
                        formatted += ' ';
                    }
                    formatted += value[i];
                }
                
                this.value = formatted;
            });
            

            document.getElementById('card-expiry').addEventListener('input', function(e) {
                let value = this.value.replace(/\D/g, '');
                
                if (value.length > 2) {
                    this.value = value.substring(0, 2) + '/' + value.substring(2, 4);
                } else {
                    this.value = value;
                }
            });
            

            document.getElementById('card-cvv').addEventListener('input', function(e) {
                this.value = this.value.replace(/\D/g, '').substring(0, 3);
            });
            

            document.querySelectorAll('.callback-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.getElementById('callback-modal').style.display = 'block';
                });
            });
            

            document.querySelectorAll('.modal-close').forEach(btn => {
                btn.addEventListener('click', () => {
                    btn.closest('.modal').style.display = 'none';
                });
            });
            

            document.getElementById('callback-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                fetch('/callback/', {
                    method: 'POST',
                    body: new FormData(this),
                    headers: {
                        'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        document.getElementById('callback-form').style.display = 'none';
                        document.getElementById('callback-success').style.display = 'block';
                        setTimeout(() => {
                            document.getElementById('callback-modal').style.display = 'none';
                            document.getElementById('callback-form').style.display = 'block';
                            document.getElementById('callback-success').style.display = 'none';
                        }, 2000);
                    } else {
                        alert('–û—à–∏–±–∫–∞: ' + (data.errors || '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö'));
                    }
                });
            });
            

            const hamburger = document.getElementById('hamburger');
            const navigation = document.querySelector('.navigation');
            
            hamburger.addEventListener('click', () => {
                navigation.classList.toggle('show');
            });
        });


document.querySelectorAll('.modal-close').forEach(closeBtn => {
    closeBtn.addEventListener('click', function() {
        this.closest('.modal').style.display = 'none';
    });
});


document.querySelectorAll('.modal').forEach(modal => {
    modal.addEventListener('click', function(e) {
        if (e.target === this) {
            this.style.display = 'none';
        }
    });
});
</script>
</body>
</html>